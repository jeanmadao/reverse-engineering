from utils import *

eax = Register(0)
ebx = Register(0)
ecx = Register(0)
edx = Register(0)

eax_content = b'\xb8\x04\x00\x00\x00\xbb\x01\x00\x00\x00\xb9\xa1\x91\x04\x08\xba\x26\x00\x00\x00\xcd\x80\xb8\x03\x00\x00\x00\x31\xdb\xb9\x88\x91\x04\x08\xba\x33\x00\x00\x00\xcd\x80\x31\xc9\xb8\x80\x80\x04\x08\xbb\x23\x81\x04\x08\xe8\x5b\x00\x00\x00\x89\xca\xb9\x19\x00\x00\x00\xb8\x55\x91\x04\x08\xbb\x88\x91\x04\x08\xd1\xca\x8a\x44\x08\xff\x8a\x5c\x0b\xff\x30\xd8\x30\xd0\x75\x1b\x49\x75\xe3\xb8\x04\x00\x00\x00\xbb\x01\x00\x00\x00\xb9\x24\x91\x04\x08\xba\x26\x00\x00\x00\xcd\x80\xeb\x16\xb8\x04\x00\x00\x00\xbb\x01\x00\x00\x00\xb9\x4a\x91\x04\x08\xba\x0b\x00\x00\x00\xcd\x80\xb8\x01\x00\x00\x00\x31\xdb\xcd\x80\x29\xc3\x31\xc9\x02\x08\xc1\xc1\x03\x40\x4b\x75\xf7\xc3'
eax_address = 0x8048080

ecx.mov(0)
eax.mov(0x8048080)
ebx.mov(0x8048123)
ebx.sub(eax)
ecx.mov(0)

while ebx.get_value():
    ecx.add_lsb(8, eax_content[eax - eax_address])
    ecx.rol(3)
    eax.inc()
    ebx.dec()

# print(hex(ecx.get_value()))
# print(ebx.get_value())

edx.mov(ecx)
ecx.mov(0x19)

eax_content = b'\x1e\xcd\x2a\xd5\x34\x87\xfc\x78\x64\x35\x9d\xec\xde\x15\xac\x97\x99\xaf\x96\xda\x79\x26\x4f\x32\xe0'

res = bytearray()
while ecx.get_value():
    edx.ror(1)
    eax.mov_lsb(8, eax_content[ecx.get_value() - 1])

    res.append(eax.get_lsb(8) ^ edx.get_lsb(8))

    ecx.dec()
print(res[::-1].decode("utf-8"))
